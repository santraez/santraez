---
import type { GetStaticPaths } from 'astro'

import MainLayout from '@/layouts/MainLayout.astro'
import PokemonCard from '@/components/PokemonCard.astro'
import type { Pokemon } from '@/interfaces/pokemon'

export const getStaticPaths = (async () => {
  const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=200')

  const data = (await response.json()) as Pokemon
  
  return data.results.map(pokemon => ({
    params: { name: pokemon.name },
    props: {
      name: pokemon.name,
      url: pokemon.url
    }
  }))
}) satisfies GetStaticPaths

const { name } = Astro.params
const { url } = Astro.props

const id = url.split('/').at(-2)
const audioSrc = `https://raw.githubusercontent.com/PokeAPI/cries/main/cries/pokemon/latest/${id}.ogg`
const imageSrc = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${id}.png`
---

<MainLayout
  title={`Pokemon - #${id} ${name}`}
  image={imageSrc}
  description={`Details about the PokÃ©mon #${id} ${name}.`}
>
  <section class='flex flex-col justify-center items-center mx-10 mt-10'>
    <div>
      <button onclick='history.back()'>
        Back to List
      </button>

      <h1 class='text-5xl capitalize'>#{id} {name}</h1>
    </div>

    <PokemonCard name={name} url={url} isBig/>
    
    <audio controls class='mt-5'>
      <source src={audioSrc} type='audio/ogg' />
    </audio>
  </section>
</MainLayout>
