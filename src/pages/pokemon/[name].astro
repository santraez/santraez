---
import MainLayout from '../../layouts/MainLayout.astro'
import PokemonCard from '../../components/PokemonCard.astro'
import type { GetStaticPaths } from 'astro'
import type { Pokemon } from '../../interfaces/pokemon'

export const getStaticPaths = (async () => {
  const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=200')

  const data = (await response.json()) as Pokemon
  
  return data.results.map(pokemon => ({
    params: { name: pokemon.name },
    props: {
      name: pokemon.name,
      url: pokemon.url
    }
  }))
}) satisfies GetStaticPaths

const { name } = Astro.params
const { url } = Astro.props

const id = url.split('/').at(-2)
const audioSrc = `https://raw.githubusercontent.com/PokeAPI/cries/main/cries/pokemon/latest/${id}.ogg`
---

<MainLayout title='Pokemon'>
  <section class='flex flex-col justify-center items-center mx-10 mt-10'>
    <div>
      <a href='/pokemon'>Back to List</a>

      <h1 class='text-5xl capitalize'>#{id} {name}</h1>
    </div>

    <PokemonCard name={name} url={url} isBig/>
    
    <audio controls class='mt-5'>
      <source src={audioSrc} type='audio/ogg' />
    </audio>
  </section>
</MainLayout>
